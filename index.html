<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Man Hour Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        /* ==================== CSS VARIABLES ==================== */
        :root {
            /* Colors */
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #0ea5e9;
            
            /* Backgrounds */
            --bg-main: #f0f4f8;
            --bg-gradient: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            --bg-sidebar: linear-gradient(180deg, #1e3a8a 0%, #2563eb 100%);
            --bg-header: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            
            /* Text */
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #9ca3af;
            --text-white: #ffffff;
            
            /* Borders */
            --border-color: #e5e7eb;
            --border-radius: 10px;
            --border-radius-sm: 6px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.15);
        }

        /* ==================== RESET & BASE ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            margin: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ==================== CONTAINER & LAYOUT ==================== */
        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* ==================== SIDEBAR NAVIGATION ==================== */
        .sidebar {
            background: var(--bg-sidebar);
            width: 280px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 50;
        }

        .sidebar-header {
            padding: 32px 20px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            text-align: center;
        }

        .sidebar-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 12px;
            border-radius: 50%;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .sidebar-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: white;
            line-height: 1.3;
            margin: 0 0 4px 0;
        }

        .sidebar-subtitle {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.75);
            font-weight: 500;
        }

        .nav-section {
            padding: 16px 12px;
        }

        .nav-section-title {
            padding: 8px 12px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.65);
            margin-bottom: 4px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin: 2px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
            font-weight: 500;
            border-left: 3px solid transparent;
            background: none;
            border-right: none;
            border-top: none;
            border-bottom: none;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: white;
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            border-left-color: white;
            color: white;
            font-weight: 600;
        }

        .nav-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 16px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.15);
        }

        .sidebar-update {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.75);
            text-align: center;
            line-height: 1.5;
        }

        /* ==================== CONTENT AREA ==================== */
        .content {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-gradient);
        }

        .content-inner {
            padding: 25px;
            max-width: 1800px;
            margin: 0 auto;
        }

        /* ==================== PAGE SECTIONS ==================== */
        .page {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .page-title {
            font-size: 26px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 0;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .kpi-card.success { border-left-color: var(--success); }
        .kpi-card.warning { border-left-color: var(--warning); }
        .kpi-card.danger { border-left-color: var(--danger); }
        .kpi-card.info { border-left-color: var(--info); }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .kpi-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .kpi-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-compare {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .trend-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .trend-up {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .trend-down {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        /* Tree Styles */
        .tree {
            margin: 0;
            padding: 0;
        }

        .tree ul {
            padding-top: 20px;
            position: relative;
            transition: all 0.5s;
            display: flex;
            justify-content: center;
        }

        .tree li {
            float: left;
            text-align: center;
            list-style-type: none;
            position: relative;
            padding: 20px 5px 0 5px;
            transition: all 0.5s;
        }

        .tree li::before,
        .tree li::after {
            content: '';
            position: absolute;
            top: 0;
            right: 50%;
            border-top: 2px solid #667eea;
            width: 50%;
            height: 20px;
        }

        .tree li::after {
            right: auto;
            left: 50%;
            border-left: 2px solid #667eea;
        }

        .tree li:only-child::after,
        .tree li:only-child::before {
            display: none;
        }

        .tree li:only-child {
            padding-top: 0;
        }

        .tree li:first-child::before,
        .tree li:last-child::after {
            border: 0 none;
        }

        .tree li:last-child::before {
            border-right: 2px solid #667eea;
            border-radius: 0 5px 0 0;
        }

        .tree li:first-child::after {
            border-radius: 5px 0 0 0;
        }

        .tree ul ul::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            border-left: 2px solid #667eea;
            width: 0;
            height: 20px;
        }

        .tree-node {
            border: 2px solid #667eea;
            padding: 0.75rem 1rem;
            display: inline-block;
            border-radius: 5px;
            background: white;
            color: #333;
            transition: all 0.3s;
            min-width: 120px;
        }

        .tree-node:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .tree-node strong {
            display: block;
            margin-bottom: 0.25rem;
        }

        .tree-node small {
            color: #666;
            font-size: 0.85rem;
        }

        .tree-node:hover small {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: 1px solid var(--primary-light);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .btn:hover {
            background: #eff6ff;
            border-color: var(--primary);
        }

        .btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Charts */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
        }

        .chart-card:hover {
            box-shadow: var(--shadow-lg);
        }

        .chart-card h3 {
            margin-bottom: 0.8rem;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
        }

        /* Tables */
        .table-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8fafc;
            border-bottom: 2px solid var(--border-color);
        }

        th {
            padding: 8px 12px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-right: 1px solid var(--border-color);
            font-size: 0.8rem;
        }

        th:last-child {
            border-right: none;
        }

        td {
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        td:last-child {
            border-right: none;
        }

        .highlight-number {
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .highlight-primary {
            background: rgba(37, 99, 235, 0.1);
            color: #2563eb;
        }

        .highlight-success {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .highlight-info {
            background: rgba(99, 102, 241, 0.1);
            color: #6366f1;
        }

        .highlight-orange {
            background: rgba(251, 146, 60, 0.1);
            color: #ea580c;
        }

        tr:hover .highlight-number {
            transform: scale(1.05);
            transition: transform 0.2s;
        }

        tbody tr:hover {
            background: #f8fafc;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .table-wrapper {
            overflow-x: auto;
        }

        /* Heat Map Styles */
        .heatmap-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #e2e8f0;
        }

        .heatmap-header {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            border: 1px solid #1e40af;
        }

        .heatmap-table tbody tr td:first-child {
            background: #f8fafc;
            font-weight: 600;
            color: var(--text-primary);
            text-align: left;
            padding-left: 16px;
            border: 1px solid #e2e8f0;
        }

        .heatmap-cell {
            padding: 14px;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            border: none;
        }

        .heatmap-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        .heatmap-value {
            display: block;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .heatmap-label {
            display: block;
            font-size: 10px;
            opacity: 0.8;
        }

        .heatmap-total {
            background: #f8fafc !important;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
            border: 2px solid var(--border-color);
        }

        .heatmap-legend {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 0.5rem;
            padding: 0.8rem;
            background: #f8fafc;
            border-radius: 8px;
        }

        .legend-gradient {
            display: flex;
            height: 24px;
            flex: 1;
            border-radius: 4px;
            overflow: hidden;
        }

        .legend-gradient div {
            flex: 1;
        }

        .legend-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 12px;
            color: #64748b;
        }

        /* Hierarchical Tree with Bars - Compact Vertical Layout */
        .hierarchy-tree {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 0.5rem;
        }

        .tree-node-wrapper {
            display: flex;
            align-items: stretch;
            margin: 6px 0;
        }

        .tree-node-content {
            display: flex;
            flex-direction: column;
            padding: 10px;
            border-radius: 8px;
            background: #f8fafc;
            transition: all 0.2s;
            min-width: 140px;
            border-left: 4px solid var(--primary);
            position: relative;
        }

        .tree-node-content:hover {
            background: #e0f2fe;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tree-node-header {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }

        .expand-btn {
            width: 18px;
            height: 18px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            font-size: 10px;
            margin-right: 8px;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .expand-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        .expand-btn.no-children {
            visibility: hidden;
        }

        .tree-node-label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 11px;
            flex: 1;
        }

        .tree-node-bar-section {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .tree-node-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .tree-node-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 10px;
            transition: width 0.6s ease;
        }

        .tree-node-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 10px;
        }

        .tree-node-percentage {
            font-weight: 600;
            color: var(--primary);
        }

        .tree-node-value {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 12px;
        }

        .tree-children {
            margin-left: 32px;
            display: none;
            padding-left: 20px;
            border-left: 2px dashed #cbd5e1;
            position: relative;
            margin-top: 8px;
        }

        .tree-children::before {
            content: '';
            position: absolute;
            left: -2px;
            top: 0;
            width: 2px;
            height: 20px;
            background: var(--primary);
        }

        .tree-children.expanded {
            display: block;
        }

        .tree-children.expanded .tree-node-wrapper::before {
            content: '';
            position: absolute;
            left: -16px;
            top: 20px;
            width: 14px;
            height: 2px;
            background: #cbd5e1;
        }

        .tree-level-0 .tree-node-content {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            padding: 10px;
            border-left: 5px solid var(--primary);
            min-width: 160px;
        }

        .tree-level-0 .tree-node-label {
            font-size: 12px;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .tree-level-0 .tree-node-value {
            font-size: 13px;
        }

        .tree-level-0 .tree-node-bar {
            height: 22px;
        }

        .tree-level-1 .tree-node-content {
            background: #f1f5f9;
            border-left: 4px solid #3b82f6;
            min-width: 140px;
        }

        .tree-level-1 .tree-node-bar-fill {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
        }

        .tree-level-1 .tree-node-label {
            font-size: 10.5px;
            font-weight: 600;
        }

        .tree-level-2 .tree-node-content {
            background: #fffbeb;
            border-left: 3px solid #10b981;
            padding: 6px;
            min-width: 120px;
        }

        .tree-level-2 .tree-node-bar-fill {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }

        .tree-level-2 .tree-node-percentage,
        .tree-level-2 .tree-node-value {
            color: #059669;
        }

        .tree-level-2 .tree-node-label {
            font-size: 10px;
        }

        .tree-level-2 .tree-node-bar {
            height: 14px;
        }

        /* Filters */
        .filter-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .filter-group label {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label span {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .filter-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .filter-section.inline {
            margin-bottom: 0;
            padding: 0.8rem 1rem;
            display: inline-block;
            width: auto;
        }

        .filter-section.inline h3 {
            display: none;
        }

        .page-header-with-filters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .page-header-with-filters .page-header {
            margin-bottom: 0;
            flex: 1;
            min-width: 300px;
        }

        .filter-section h3 {
            margin: 0 0 1rem 0;
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-section h3::before {
            content: 'üîç';
            font-size: 16px;
        }

        .filter-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            min-width: 160px;
        }

        .filter-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-group select,
        .filter-item select {
            padding: 0.7rem 1rem;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 0.95rem;
            cursor: pointer;
            background: white;
            min-width: 200px;
            transition: all 0.2s;
        }

        .filter-group select:focus,
        .filter-item select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-group select:hover,
        .filter-item select:hover {
            border-color: #667eea;
        }

        /* Details Grid */
        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
            background: #f9f9f9;
            padding: 1.5rem;
            border-radius: 8px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .detail-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .detail-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        /* Progress Bar */
        .progress-bar {
            background: #e8eef7;
            height: 24px;
            border-radius: 4px;
            overflow: hidden;
            margin: 0.3rem 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }

            .nav-links {
                gap: 1rem;
            }

            .kpi-grid {
                grid-template-columns: 1fr 1fr;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .nav-content {
                flex-direction: column;
                gap: 1rem;
            }

            th, td {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üìä</div>
                <h1 class="sidebar-title">Man Hour Dashboard</h1>
                <p class="sidebar-subtitle">H·ªá th·ªëng qu·∫£n l√Ω gi·ªù c√¥ng</p>
            </div>

            <nav class="nav-section">
                <div class="nav-section-title">MENU CH√çNH</div>
                <button class="nav-item active" data-page="page1">
                    <span class="nav-icon">üìà</span>
                    <span>T·ªïng Quan</span>
                </button>
                <button class="nav-item" data-page="page2">
                    <span class="nav-icon">üè¢</span>
                    <span>Chi Ti·∫øt B·ªô Ph·∫≠n</span>
                </button>
                <button class="nav-item" data-page="page3">
                    <span class="nav-icon">üë•</span>
                    <span>Chi Ti·∫øt Nh√¢n S·ª±</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <div class="sidebar-update">
                    C·∫≠p nh·∫≠t: <strong>07/01/2026</strong><br>
                    D·ªØ li·ªáu real-time
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="content">
            <div class="content-inner">

        <!-- PAGE 1: OVERVIEW -->
        <div id="page1" class="page active">
            <div class="page-header-with-filters">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">üìä T·ªïng Quan Man Hour</h1>
                        <p class="page-subtitle">S·ªë li·ªáu c√¥ng su·∫•t to√†n c√¥ng ty</p>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="filter-section inline">
                    <h3>B·ªô L·ªçc D·ªØ Li·ªáu</h3>
                    <div class="filter-controls">
                        <div class="filter-item">
                            <label class="filter-label">Th·ªùi Gian</label>
                            <select id="filterTime" onchange="applyFilters()">
                                <option value="month">Th√°ng Hi·ªán T·∫°i</option>
                                <option value="quarter">Qu√Ω Hi·ªán T·∫°i</option>
                                <option value="year">NƒÉm Hi·ªán T·∫°i</option>
                                <option value="last-month">Th√°ng Tr∆∞·ªõc</option>
                                <option value="last-quarter">Qu√Ω Tr∆∞·ªõc</option>
                                <option value="custom">T√πy Ch·ªânh</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">Lo·∫°i Gi·ªù L√†m</label>
                            <select id="filterWorkType" onchange="applyFilters()">
                                <option value="all">T·∫•t C·∫£</option>
                                <option value="h1">H1 - Gi·ªù H√†nh Ch√≠nh</option>
                                <option value="h2">H2 - Gi·ªù OT Th∆∞·ªùng</option>
                                <option value="h3">H3 - Gi·ªù OT Cu·ªëi Tu·∫ßn</option>
                                <option value="regular">Ch·ªâ Gi·ªù H√†nh Ch√≠nh</option>
                                <option value="overtime">Ch·ªâ Gi·ªù OT (H2+H3)</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">Groups/Teams</label>
                            <select id="filterGroups" onchange="applyFilters()">
                                <option value="all">T·∫•t C·∫£ Teams</option>
                                <option value="brv1">BRV1</option>
                                <option value="brv2">BRV2</option>
                                <option value="brv3">BRV3</option>
                                <option value="brv4">BRV4</option>
                                <option value="brv5">BRV5</option>
                                <option value="brv6">BRV6</option>
                                <option value="brv7">BRV7</option>
                                <option value="brv8">BRV8</option>
                            </select>
                        </div>
                        <button class="btn" onclick="resetFilters()" style="align-self: flex-end; background: #64748b; color: white; border: none; margin-top: 1.5rem;">
                            ‚Ü∫ ƒê·∫∑t L·∫°i
                        </button>
                    </div>
                </div>
            </div>

            <!-- KPI Cards with Trend -->
            <div class="kpi-grid">
                <div class="kpi-card success">
                    <div class="kpi-header">
                        <span class="kpi-label">S·ªë D·ª± √Ån</span>
                        <span class="trend-badge trend-up">+12.5%</span>
                    </div>
                    <div class="kpi-number">24</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 21</div>
                </div>
                <div class="kpi-card info">
                    <div class="kpi-header">
                        <span class="kpi-label">S·ªë Nh√¢n S·ª±</span>
                        <span class="trend-badge trend-up">+3.3%</span>
                    </div>
                    <div class="kpi-number">156</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 151</div>
                </div>
                <div class="kpi-card warning">
                    <div class="kpi-header">
                        <span class="kpi-label">C√¥ng Su·∫•t TB</span>
                        <span class="trend-badge trend-down">-2.1%</span>
                    </div>
                    <div class="kpi-number">78.5%</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 80.2%</div>
                </div>
                <div class="kpi-card danger">
                    <div class="kpi-header">
                        <span class="kpi-label">TB Nh√¢n S·ª± / D·ª± √Ån</span>
                        <span class="trend-badge trend-down">-8.2%</span>
                    </div>
                    <div class="kpi-number">6.5</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 7.1</div>
                </div>
            </div>

            <!-- Charts Section 1 - 3 charts in one row -->
            <div class="chart-grid" style="grid-template-columns: repeat(3, 1fr); gap: 0.8rem;">
                <div class="chart-card">
                    <h3>T·ªïng Gi·ªù L√†m Vi·ªác Theo Th·ªùi Gian</h3>
                    <canvas id="chartWorkHours"></canvas>
                </div>
                <div class="chart-card">
                    <h3>C∆° C·∫•u Gi·ªù L√†m (H√†nh Ch√≠nh vs OT)</h3>
                    <div style="height: 240px; position: relative;">
                        <canvas id="chartOTDistribution"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>S·ªë Gi·ªù Cho C√°c D·ª± √Ån</h3>
                    <canvas id="chartProjects"></canvas>
                </div>
            </div>

            <!-- Charts Section 2 - 2 items in one row -->
            <div class="chart-grid" style="grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <div class="chart-card" style="max-height: 350px;">
                    <h3>So S√°nh T·ªïng Gi·ªù v√† Gi·ªù TB c·ªßa Teams</h3>
                    <div class="table-wrapper" style="margin-top: 0.5rem; max-height: 280px; overflow-y: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Team</th>
                                    <th>T·ªïng Gi·ªù L√†m</th>
                                    <th>S·ªë Nh√¢n S·ª±</th>
                                    <th>Gi·ªù TB/Nh√¢n S·ª±</th>
                                    <th>S·ªë D·ª± √Ån</th>
                                    <th>Gi·ªù TB/D·ª± √Ån</th>
                                    <th>Hi·ªáu Su·∫•t</th>
                                </tr>
                            </thead>
                            <tbody id="teamHoursTableBody">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="chart-card" style="max-height: 350px;">
                    <h3 style="margin-bottom: 0.5rem;">C∆° C·∫•u Gi·ªù L√†m (H1, H2, H3)</h3>
                    <div id="hierarchyTreeChart" style="padding: 0.3rem; max-height: 290px; overflow-y: auto;">
                        <!-- Dynamic hierarchical tree with bars -->
                    </div>
                </div>
            </div>

            <!-- Heat Map -->
            <h2 style="margin-top: 1.5rem; margin-bottom: 0.8rem; color: var(--text-primary); display: flex; align-items: center; justify-content: space-between;">
                <span>Heat Map Gi·ªù Ti√™u T·ªën Theo Team</span>
                <div class="button-group" style="margin: 0;">
                    <button class="btn btn-sm active" onclick="switchHeatmapView('hours', this)">Gi·ªù l√†m</button>
                    <button class="btn btn-sm" onclick="switchHeatmapView('capacity', this)">C√¥ng su·∫•t</button>
                </div>
            </h2>
            <div class="chart-card" style="max-height: 320px;">
                <!-- C∆∞·ªùng ƒë·ªô gi·ªù l√†m -->
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.8rem; font-size: 0.85rem; color: var(--text-secondary);">
                    <span style="font-weight: 600;">‚ÑπÔ∏è C∆∞·ªùng ƒë·ªô:</span>
                    <div style="display: flex; align-items: center; gap: 0.3rem;">
                        <div style="width: 30px; height: 16px; background: rgb(220, 240, 220); border: 1px solid #ddd;"></div>
                        <span style="font-size: 0.8rem;">Nh·∫°t</span>
                    </div>
                    <span>‚Üí</span>
                    <div style="display: flex; align-items: center; gap: 0.3rem;">
                        <div style="width: 30px; height: 16px; background: rgb(100, 160, 100); border: 1px solid #ddd;"></div>
                        <span style="font-size: 0.8rem;">ƒê·∫≠m</span>
                    </div>
                </div>
                <div id="heatmapContainer" style="overflow-x: auto; max-height: 260px;">
                    <table class="heatmap-table">
                        <thead>
                            <tr>
                                <th class="heatmap-header">Team</th>
                                <th class="heatmap-header">Tu·∫ßn 1</th>
                                <th class="heatmap-header">Tu·∫ßn 2</th>
                                <th class="heatmap-header">Tu·∫ßn 3</th>
                                <th class="heatmap-header">Tu·∫ßn 4</th>
                                <th class="heatmap-header" id="heatmapLastColumn">T·ªïng</th>
                            </tr>
                        </thead>
                        <tbody id="heatmapBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PAGE 2: DEPARTMENT DETAILS -->
        <div id="page2" class="page">
            <div class="page-header-with-filters">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">üè¢ Chi Ti·∫øt B·ªô Ph·∫≠n</h1>
                        <p class="page-subtitle">Ph√¢n t√≠ch chi ti·∫øt c√¥ng su·∫•t v√† hi·ªáu su·∫•t theo team</p>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="filter-section inline">
                    <h3>B·ªô L·ªçc D·ªØ Li·ªáu</h3>
                    <div class="filter-controls">
                        <div class="filter-item">
                            <label class="filter-label">Th·ªùi Gian</label>
                            <select id="filterTimeTeam" onchange="applyTeamFilters()">
                                <option value="month">Th√°ng Hi·ªán T·∫°i</option>
                                <option value="quarter">Qu√Ω Hi·ªán T·∫°i</option>
                                <option value="year">NƒÉm Hi·ªán T·∫°i</option>
                                <option value="last-month">Th√°ng Tr∆∞·ªõc</option>
                                <option value="last-quarter">Qu√Ω Tr∆∞·ªõc</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">Lo·∫°i Gi·ªù L√†m</label>
                            <select id="filterWorkTypeTeam" onchange="applyTeamFilters()">
                                <option value="all">T·∫•t C·∫£</option>
                                <option value="h1">H1 - Gi·ªù H√†nh Ch√≠nh</option>
                                <option value="h2">H2 - Gi·ªù OT Th∆∞·ªùng</option>
                                <option value="h3">H3 - Gi·ªù OT Cu·ªëi Tu·∫ßn</option>
                                <option value="regular">Ch·ªâ Gi·ªù H√†nh Ch√≠nh</option>
                                <option value="overtime">Ch·ªâ Gi·ªù OT (H2+H3)</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">Team</label>
                            <select id="filterGroupsTeam" onchange="applyTeamFilters()">
                                <option value="all">T·∫•t C·∫£ Teams</option>
                                <option value="brv1">BRV1</option>
                                <option value="brv2">BRV2</option>
                                <option value="brv3">BRV3</option>
                                <option value="brv4">BRV4</option>
                                <option value="brv5">BRV5</option>
                                <option value="brv6">BRV6</option>
                                <option value="brv7">BRV7</option>
                                <option value="brv8">BRV8</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">Nh√¢n S·ª±</label>
                            <select id="filterEmployee" onchange="applyTeamFilters()">
                                <option value="all">T·∫•t C·∫£</option>
                                <option value="emp1">Nguy·ªÖn VƒÉn A</option>
                                <option value="emp2">Tr·∫ßn Th·ªã B</option>
                                <option value="emp3">L√™ Ho√†ng C</option>
                                <option value="emp4">Ph·∫°m Minh D</option>
                                <option value="emp5">ƒê·∫∑ng Qu·ªëc E</option>
                            </select>
                        </div>
                        <button class="btn" onclick="resetTeamFilters()" style="align-self: flex-end; background: #64748b; color: white; border: none; margin-top: 1.5rem;">
                            ‚Ü∫ ƒê·∫∑t L·∫°i
                        </button>
                    </div>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card success">
                    <div class="kpi-header">
                        <span class="kpi-label">T·ªïng Gi·ªù L√†m</span>
                        <span class="trend-badge trend-up">+8.5%</span>
                    </div>
                    <div class="kpi-number" id="teamTotalHours">2,240</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 2,064</div>
                </div>
                <div class="kpi-card info">
                    <div class="kpi-header">
                        <span class="kpi-label">S·ªë Nh√¢n S·ª±</span>
                        <span class="trend-badge trend-up">+4.0%</span>
                    </div>
                    <div class="kpi-number" id="teamEmployees">25</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 24</div>
                </div>
                <div class="kpi-card warning">
                    <div class="kpi-header">
                        <span class="kpi-label">C√¥ng Su·∫•t TB</span>
                        <span class="trend-badge trend-up">+2.5%</span>
                    </div>
                    <div class="kpi-number" id="teamCapacity">82%</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 80%</div>
                </div>
                <div class="kpi-card primary">
                    <div class="kpi-header">
                        <span class="kpi-label">S·ªë D·ª± √Ån</span>
                        <span class="trend-badge trend-up">+14.3%</span>
                    </div>
                    <div class="kpi-number" id="teamProjects">8</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 7</div>
                </div>
            </div>

            <!-- Charts Row 1: 3 charts -->
            <div class="chart-grid" style="grid-template-columns: repeat(3, 1fr); gap: 0.8rem; margin-bottom: 1rem;">
                <div class="chart-card">
                    <h3>T·ªïng Gi·ªù L√†m Vi·ªác Theo Th·ªùi Gian</h3>
                    <canvas id="chartTeamHours"></canvas>
                </div>
                <div class="chart-card">
                    <h3>C√¥ng Su·∫•t Lao ƒê·ªông Theo Th·ªùi Gian</h3>
                    <canvas id="chartTeamCapacity"></canvas>
                </div>
                <div class="chart-card">
                    <h3>S·ªë Gi·ªù Cho C√°c D·ª± √Ån</h3>
                    <canvas id="chartTeamProjects"></canvas>
                </div>
            </div>

            <!-- Charts Row 2: Employee table + Work structure -->
            <div class="chart-grid" style="grid-template-columns: 2fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div class="chart-card">
                    <h3>So S√°nh Chi Ti·∫øt Nh√¢n S·ª± Trong Team</h3>
                    <div style="max-height: 320px; overflow-y: auto;">
                        <table style="width: 100%;">
                            <thead>
                                <tr style="background: #f8fafc;">
                                    <th style="padding: 8px; text-align: left;">H·ªç T√™n</th>
                                    <th style="padding: 8px; text-align: left;">Ch·ª©c V·ª•</th>
                                    <th style="padding: 8px; text-align: center;">S·ªë D·ª± √Ån</th>
                                    <th style="padding: 8px; text-align: right;">Gi·ªù L√†m/Th√°ng</th>
                                    <th style="padding: 8px; text-align: center;">C√¥ng Su·∫•t</th>
                                    <th style="padding: 8px; text-align: right;">H1</th>
                                    <th style="padding: 8px; text-align: right;">H2</th>
                                    <th style="padding: 8px; text-align: right;">H3</th>
                                </tr>
                            </thead>
                            <tbody id="teamEmployeeTableBody">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>C∆° C·∫•u Th·ªùi Gian L√†m</h3>
                    <div id="teamWorkStructure" style="max-height: 280px; overflow-y: auto;">
                        <!-- Matrix table -->
                    </div>
                </div>
            </div>

            <!-- Charts Row 3: Heatmap + Project Work table -->
            <div class="chart-grid" style="grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>

            <!-- Charts Row 3: Heatmap + Project Work table -->
            <div class="chart-grid" style="grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div class="chart-card" style="max-height: 400px;">
                    <h3>Heat Map Gi·ªù L√†m - Tu·∫ßn √ó Nh√¢n S·ª±</h3>
                    <div style="overflow-x: auto; max-height: 340px;">
                        <table class="heatmap-table">
                            <thead>
                                <tr>
                                    <th class="heatmap-header">Nh√¢n S·ª±</th>
                                    <th class="heatmap-header">Tu·∫ßn 1</th>
                                    <th class="heatmap-header">Tu·∫ßn 2</th>
                                    <th class="heatmap-header">Tu·∫ßn 3</th>
                                    <th class="heatmap-header">Tu·∫ßn 4</th>
                                    <th class="heatmap-header">T·ªïng</th>
                                </tr>
                            </thead>
                            <tbody id="employeeHeatmapBody">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="chart-card" style="max-height: 400px;">
                    <h3>Chi Ti·∫øt C√¥ng Vi·ªác Theo D·ª± √Ån</h3>
                    <div style="overflow-y: auto; max-height: 340px;">
                        <table style="width: 100%;">
                            <thead>
                                <tr style="background: #f8fafc;">
                                    <th style="width: 30px; padding: 8px;"></th>
                                    <th style="padding: 8px; text-align: left;">D·ª± √Ån / C√¥ng Vi·ªác</th>
                                    <th style="padding: 8px; text-align: center;">Ng√†y</th>
                                    <th style="padding: 8px; text-align: left;">Nh√¢n S·ª±</th>
                                    <th style="padding: 8px; text-align: right;">Gi·ªù L√†m</th>
                                    <th style="padding: 8px; text-align: center;">Lo·∫°i Gi·ªù</th>
                                    <th style="padding: 8px; text-align: center;">Tr·∫°ng Th√°i</th>
                                </tr>
                            </thead>
                            <tbody id="projectWorkTableBody">
                                <!-- Dynamic content with expand/collapse -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGE 3: EMPLOYEE DETAILS -->
        <div id="page3" class="page">
            <div class="page-header-with-filters">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">üë• Chi Ti·∫øt Nh√¢n S·ª±</h1>
                        <p class="page-subtitle">Qu·∫£n l√Ω v√† ph√¢n t√≠ch chi ti·∫øt t·ª´ng nh√¢n s·ª±</p>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="filter-section inline">
                    <h3>B·ªô L·ªçc D·ªØ Li·ªáu</h3>
                    <div class="filter-controls">
                        <div class="filter-item">
                            <label class="filter-label">Ch·ªçn Nh√¢n S·ª±</label>
                            <select id="empSelector" onchange="loadEmployeeDetail()">
                                <option value="0">Nguy·ªÖn VƒÉn A</option>
                                <option value="1">Tr·∫ßn Th·ªã B</option>
                                <option value="2">Ph·∫°m Minh C</option>
                                <option value="3">L√™ Ho√†ng D</option>
                                <option value="4">ƒê·∫∑ng Qu·ªëc E</option>
                                <option value="5">V≈© Thanh F</option>
                                <option value="6">B√πi H∆∞∆°ng G</option>
                                <option value="7">Cao Xu√¢n H</option>
                                <option value="8">D∆∞∆°ng Th·∫ø I</option>
                                <option value="9">Ho√†ng Minh K</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employee Profile -->
            <div class="chart-card" style="margin-bottom: 1.5rem;">
                <div style="display: flex; gap: 2rem; align-items: flex-start;">
                    <div style="flex-shrink: 0;">
                        <div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; font-weight: bold; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                            <span id="empInitials">NA</span>
                        </div>
                    </div>
                    <div style="flex: 1;">
                        <h2 style="margin: 0 0 0.5rem 0; color: var(--text-primary); font-size: 24px;" id="empName">Nguy·ªÖn VƒÉn A</h2>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem;">
                            <div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Ch·ª©c V·ª•</div>
                                <div style="font-weight: 600; color: var(--text-primary);" id="empRole">Senior Dev</div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Team</div>
                                <div style="font-weight: 600; color: var(--text-primary);" id="empTeam">BRV1</div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Email</div>
                                <div style="font-weight: 600; color: #3b82f6;" id="empEmail">nguyen.a@company.com</div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">ƒêi·ªán Tho·∫°i</div>
                                <div style="font-weight: 600; color: var(--text-primary);" id="empPhone">0912-345-678</div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Ng√†y V√†o L√†m</div>
                                <div style="font-weight: 600; color: var(--text-primary);" id="empJoinDate">15/03/2020</div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Kinh Nghi·ªám</div>
                                <div style="font-weight: 600; color: var(--text-primary);" id="empExperience">5 nƒÉm 10 th√°ng</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card success">
                    <div class="kpi-header">
                        <span class="kpi-label">S·ªë D·ª± √Ån</span>
                        <span class="trend-badge trend-up">+20%</span>
                    </div>
                    <div class="kpi-number" id="empProjects">3</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 2.5</div>
                </div>
                <div class="kpi-card warning">
                    <div class="kpi-header">
                        <span class="kpi-label">C√¥ng Su·∫•t TB</span>
                        <span class="trend-badge trend-up">+5%</span>
                    </div>
                    <div class="kpi-number" id="empUtilization">95%</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 90%</div>
                </div>
                <div class="kpi-card info">
                    <div class="kpi-header">
                        <span class="kpi-label">Gi·ªù L√†m Tu·∫ßn N√†y</span>
                        <span class="trend-badge trend-up">+8%</span>
                    </div>
                    <div class="kpi-number" id="empWeekHours">43</div>
                    <div class="kpi-compare">Tu·∫ßn tr∆∞·ªõc: 40h</div>
                </div>
                <div class="kpi-card primary">
                    <div class="kpi-header">
                        <span class="kpi-label">T·ªïng Gi·ªù Th√°ng</span>
                        <span class="trend-badge trend-up">+12%</span>
                    </div>
                    <div class="kpi-number" id="empMonthHours">176</div>
                    <div class="kpi-compare">Th√°ng tr∆∞·ªõc: 157h</div>
                </div>
            </div>

            <!-- Charts Row 1 -->
            <div class="chart-grid" style="grid-template-columns: repeat(3, 1fr); gap: 0.8rem; margin-bottom: 1rem;">
                <div class="chart-card">
                    <h3>T·ªïng Gi·ªù L√†m Vi·ªác Theo Th·ªùi Gian</h3>
                    <div style="height: 240px; position: relative;">
                        <canvas id="chartEmpHours"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>S·ªë Gi·ªù Cho C√°c D·ª± √Ån</h3>
                    <div style="height: 240px; position: relative;">
                        <canvas id="chartEmpProjects"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>C∆° C·∫•u Th·ªùi Gian L√†m</h3>
                    <div id="empWorkStructure" style="max-height: 280px; overflow-y: auto; padding: 0.5rem;">
                        <!-- Matrix table -->
                    </div>
                </div>
            </div>

            <!-- Work Details by Day -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem; margin-bottom: 0.8rem;">
                <h2 style="margin: 0; color: var(--text-primary);">Chi Ti·∫øt C√¥ng Vi·ªác Theo Ng√†y</h2>
                <button onclick="showHourlyDetails()" style="padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'">
                    üìä Chi Ti·∫øt Theo Gi·ªù
                </button>
            </div>
            <div class="chart-card">
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8fafc;">
                                <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb; min-width: 200px;">C√¥ng Vi·ªác</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">Th·ª© 2<br/><small>06/01</small></th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">Th·ª© 3<br/><small>07/01</small></th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">Th·ª© 4<br/><small>08/01</small></th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">Th·ª© 5<br/><small>09/01</small></th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">Th·ª© 6<br/><small>10/01</small></th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb; background: #fef3c7;">Th·ª© 7<br/><small>11/01</small></th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb; background: #fef3c7;">CN<br/><small>12/01</small></th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb; background: #e0f2fe;"><strong>T·ªïng</strong></th>
                            </tr>
                        </thead>
                        <tbody id="empWorkByDayBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
    </div>

    <script>
        // Data
        const departments = [
            { id: 1, name: 'BRV1', employees: 25, projects: 8, budget: 450000, utilization: 82, revenue: 750000 },
            { id: 2, name: 'BRV2', employees: 20, projects: 7, budget: 380000, utilization: 88, revenue: 650000 },
            { id: 3, name: 'BRV3', employees: 18, projects: 5, budget: 320000, utilization: 75, revenue: 500000 },
            { id: 4, name: 'BRV4', employees: 15, projects: 4, budget: 280000, utilization: 80, revenue: 450000 },
            { id: 5, name: 'BRV5', employees: 12, projects: 3, budget: 200000, utilization: 85, revenue: 380000 },
            { id: 6, name: 'BRV6', employees: 14, projects: 4, budget: 240000, utilization: 78, revenue: 400000 },
            { id: 7, name: 'BRV7', employees: 16, projects: 3, budget: 260000, utilization: 83, revenue: 420000 },
            { id: 8, name: 'BRV8', employees: 15, projects: 2, budget: 250000, utilization: 76, revenue: 380000 }
        ];

        // Global teamData - moved outside function for access by initPage2
        let teamData = {
            labels: ['BRV1', 'BRV2', 'BRV3', 'BRV4', 'BRV5', 'BRV6', 'BRV7', 'BRV8'],
            totalHours: [2200, 1900, 1650, 1480, 1920, 1750, 1920, 1820],
            employees: [25, 20, 18, 15, 12, 14, 16, 15],
            projects: [8, 7, 5, 4, 3, 4, 3, 2]
        };

        const employees = [
            { name: 'Nguy·ªÖn VƒÉn A', department: 'BRV1', role: 'Senior Dev', hours: 40, utilization: 95, projects: 3, salary: 25 },
            { name: 'Tr·∫ßn Th·ªã B', department: 'BRV2', role: 'Lead Dev', hours: 40, utilization: 92, projects: 4, salary: 26 },
            { name: 'Ph·∫°m Minh C', department: 'BRV1', role: 'Mid Dev', hours: 35, utilization: 80, projects: 2, salary: 18 },
            { name: 'L√™ Ho√†ng D', department: 'BRV3', role: 'Junior Dev', hours: 30, utilization: 65, projects: 1, salary: 12 },
            { name: 'ƒê·∫∑ng Qu·ªëc E', department: 'BRV4', role: 'Senior Dev', hours: 40, utilization: 88, projects: 3, salary: 24 },
            { name: 'V≈© Thanh F', department: 'BRV5', role: 'Engineer', hours: 38, utilization: 85, projects: 2, salary: 22 },
            { name: 'B√πi H∆∞∆°ng G', department: 'BRV6', role: 'Lead', hours: 36, utilization: 78, projects: 2, salary: 20 },
            { name: 'Cao Xu√¢n H', department: 'BRV7', role: 'Mid Dev', hours: 40, utilization: 90, projects: 2, salary: 19 },
            { name: 'D∆∞∆°ng Th·∫ø I', department: 'CAD1', role: 'Mid Dev', hours: 37, utilization: 82, projects: 2, salary: 18.5 },
            { name: 'Ho√†ng Minh K', department: 'SPORT', role: 'Junior Dev', hours: 28, utilization: 70, projects: 1, salary: 13 }
        ];

        let currentDept = 0;
        let currentTimeView = 'month';
        let charts = {};

        // Navigation
        document.querySelectorAll('.nav-item').forEach(btn => {
            btn.addEventListener('click', function() {
                const pageId = this.dataset.page;
                showPage(pageId);
                document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            if (pageId === 'page1') initPage1();
            if (pageId === 'page2') initPage2();
            if (pageId === 'page3') initPage3();
        }

        // PAGE 1 - OVERVIEW
        function switchTimeView(view, btn) {
            currentTimeView = view;
            document.querySelectorAll('.button-group .btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            initPage1();
        }

        function initPage1() {
            const monthlyData = {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                actual: [6400, 6800, 7100, 7400, 7200, 7500],
                standard: [6000, 6000, 6000, 6000, 6000, 6000]
            };

            const data = monthlyData;

            // Chart 1: Work Hours Over Time with Ratio Labels
            if (charts.workHours) charts.workHours.destroy();
            charts.workHours = new Chart(document.getElementById('chartWorkHours'), {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'Gi·ªù Th·ª±c T·∫ø',
                            data: data.actual,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Gi·ªù Chu·∫©n',
                            data: data.standard,
                            borderColor: '#ff6b6b',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.y;
                                    const standard = data.standard[context.dataIndex];
                                    const ratio = ((value / standard) * 100).toFixed(1);
                                    return `${label}: ${value}h (${ratio}%)`;
                                }
                            }
                        }
                    },
                    scales: { 
                        y: { 
                            beginAtZero: true,
                            title: { display: true, text: 'Gi·ªù' }
                        } 
                    }
                }
            });

            // Chart 2: OT Distribution
            if (charts.otDistribution) charts.otDistribution.destroy();
            charts.otDistribution = new Chart(document.getElementById('chartOTDistribution'), {
                type: 'doughnut',
                data: {
                    labels: ['Gi·ªù H√†nh Ch√≠nh', 'Gi·ªù OT'],
                    datasets: [{
                        data: [6200, 1300],
                        backgroundColor: ['#667eea', '#f093fb']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const value = context.parsed;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${value}h (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14
                            },
                            formatter: function(value, context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return `${value}h\n${percentage}%`;
                            }
                        }
                    }
                }
            });

            // Table 3: Team Hours Comparison - use global teamData
            let tableHtml = '';
            teamData.labels.forEach((label, index) => {
                const totalHours = teamData.totalHours[index];
                const employees = teamData.employees[index];
                const projects = teamData.projects[index];
                const avgPerEmployee = (totalHours / employees).toFixed(1);
                const avgPerProject = (totalHours / projects).toFixed(1);
                const efficiency = avgPerEmployee >= 100 ? 'Cao' : avgPerEmployee >= 80 ? 'Trung B√¨nh' : 'Th·∫•p';
                const efficiencyClass = avgPerEmployee >= 100 ? 'badge-success' : avgPerEmployee >= 80 ? 'badge-warning' : 'badge-danger';
                
                tableHtml += `
                    <tr>
                        <td><strong>${label}</strong></td>
                        <td><span class="highlight-number highlight-primary">${totalHours.toLocaleString()}</span></td>
                        <td><span class="highlight-number highlight-info">${employees}</span></td>
                        <td><span class="highlight-number highlight-success">${avgPerEmployee}</span></td>
                        <td><span class="highlight-number highlight-info">${projects}</span></td>
                        <td><span class="highlight-number highlight-orange">${avgPerProject}</span></td>
                        <td><span class="badge ${efficiencyClass}">${efficiency}</span></td>
                    </tr>
                `;
            });
            
            const tbody = document.getElementById('teamHoursTableBody');
            if (tbody) {
                tbody.innerHTML = tableHtml;
            }

            // Hierarchical Tree with Bars - 3 levels
            const hierarchyData = {
                name: 'T·ªîNG GI·ªù L√ÄM',
                value: 14640,
                children: [
                    {
                        name: 'H1 - Gi·ªù Tr·ª±c Ti·∫øp',
                        value: 8150,
                        children: [
                            { name: 'H1_Tr·ª±c ti·∫øp', value: 6520 },
                            { name: 'H1_PM (Qu·∫£n l√Ω)', value: 1630 }
                        ]
                    },
                    {
                        name: 'H2 - Gi·ªù Gi√°n Ti·∫øp',
                        value: 4160,
                        children: [
                            { name: 'H2_Gi√°n ti·∫øp', value: 2910 },
                            { name: 'H2_Training', value: 830 },
                            { name: 'H2_Meeting', value: 420 }
                        ]
                    },
                    {
                        name: 'H3 - Gi·ªù Kh√°c',
                        value: 2330,
                        children: [
                            { name: 'H3_Off kh√¥ng l∆∞∆°ng', value: 980 },
                            { name: 'H3_Ngh·ªâ ph√©p', value: 700 },
                            { name: 'H3_Kh√°c', value: 650 }
                        ]
                    }
                ]
            };

            function renderTreeNode(node, level = 0, parentValue = 0) {
                const maxValue = level === 0 ? node.value : parentValue;
                const percentage = ((node.value / maxValue) * 100).toFixed(1);
                const hasChildren = node.children && node.children.length > 0;
                const nodeId = `node-${level}-${node.name.replace(/\s+/g, '-').replace(/[()_]/g, '')}`;
                const isExpanded = level === 0; // M·ªü s·∫µn c·∫•p 1

                let html = `
                    <div class="tree-node-wrapper tree-level-${level}">
                        <div class="tree-node-content">
                            <div class="tree-node-header">
                                <button class="expand-btn ${!hasChildren ? 'no-children' : ''}" 
                                        onclick="toggleNode('${nodeId}')" 
                                        id="btn-${nodeId}">
                                    ${hasChildren ? (isExpanded ? '-' : '+') : ''}
                                </button>
                                <span class="tree-node-label">${node.name}</span>
                            </div>
                            <div class="tree-node-bar-section">
                                <div class="tree-node-bar">
                                    <div class="tree-node-bar-fill" style="width: ${percentage}%"></div>
                                </div>
                                <div class="tree-node-info">
                                    <span class="tree-node-percentage">${percentage}%</span>
                                    <span class="tree-node-value">${node.value.toLocaleString()}h</span>
                                </div>
                            </div>
                        </div>
                `;

                if (hasChildren) {
                    html += `<div class="tree-children ${isExpanded ? 'expanded' : ''}" id="${nodeId}">`;
                    node.children.forEach(child => {
                        html += renderTreeNode(child, level + 1, node.value);
                    });
                    html += '</div>';
                }

                html += '</div>';
                return html;
            }

            document.getElementById('hierarchyTreeChart').innerHTML = `
                <div class="hierarchy-tree">
                    ${renderTreeNode(hierarchyData)}
                </div>
            `;

            // Projects Bar Chart - Horizontal
            const projectsData = {
                labels: ['D·ª± √°n A', 'D·ª± √°n B', 'D·ª± √°n C', 'D·ª± √°n D', 'D·ª± √°n E', 'D·ª± √°n F', 'D·ª± √°n G', 'D·ª± √°n H'],
                hours: [2840, 2560, 2180, 1920, 1650, 1480, 1320, 1690]
            };

            if (charts.projects) charts.projects.destroy();
            charts.projects = new Chart(document.getElementById('chartProjects'), {
                type: 'bar',
                data: {
                    labels: projectsData.labels,
                    datasets: [{
                        label: 'T·ªïng Gi·ªù',
                        data: projectsData.hours,
                        backgroundColor: [
                            '#2563eb', '#3b82f6', '#60a5fa', '#93c5fd',
                            '#1e40af', '#1e3a8a', '#4f46e5', '#6366f1'
                        ],
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.parsed.x}h`
                            }
                        }
                    },
                    scales: {
                        x: { 
                            beginAtZero: true,
                            title: { display: true, text: 'Gi·ªù' }
                        },
                        y: {
                            ticks: {
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });

            // Heat Map: Gi·ªù ti√™u t·ªën theo team v√† tu·∫ßn
            renderHeatmap();
        }

        // Toggle node expansion in hierarchy tree
        function toggleNode(nodeId) {
            const node = document.getElementById(nodeId);
            const btn = document.getElementById('btn-' + nodeId);
            
            if (node.classList.contains('expanded')) {
                node.classList.remove('expanded');
                btn.textContent = '+';
            } else {
                node.classList.add('expanded');
                btn.textContent = '-';
            }
        }

        // Switch heatmap view
        let currentHeatmapView = 'hours';
        function switchHeatmapView(view, btn) {
            currentHeatmapView = view;
            
            // Update button states
            document.querySelectorAll('.button-group .btn-sm').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Re-render heatmap with new data
            renderHeatmap();
        }

        function renderHeatmap() {
            const heatmapData = {
                teams: ['BRV1', 'BRV2', 'BRV3', 'BRV4', 'BRV5', 'BRV6', 'BRV7', 'BRV8'],
                hours: [
                    [520, 560, 540, 580],
                    [450, 480, 470, 500],
                    [400, 420, 410, 420],
                    [360, 370, 375, 375],
                    [470, 480, 485, 485],
                    [430, 440, 435, 445],
                    [475, 480, 482, 483],
                    [450, 455, 457, 458]
                ],
                capacity: [
                    [85, 88, 87, 92],
                    [78, 82, 80, 85],
                    [72, 75, 73, 76],
                    [68, 70, 71, 71],
                    [80, 82, 83, 84],
                    [75, 77, 76, 78],
                    [81, 82, 83, 83],
                    [77, 78, 79, 79]
                ]
            };

            const dataToShow = currentHeatmapView === 'hours' ? heatmapData.hours : heatmapData.capacity;
            const suffix = currentHeatmapView === 'hours' ? 'h' : '%';

            function getHeatColor(value, min, max) {
                const ratio = (value - min) / (max - min);
                
                // Gradient xanh l√° nh·∫π t·ª´ nh·∫°t ƒë·∫øn ƒë·∫≠m (soft green)
                const r = Math.round(220 - (ratio * 120));
                const g = Math.round(240 - (ratio * 80));
                const b = Math.round(220 - (ratio * 120));
                
                const bgColor = `rgb(${r}, ${g}, ${b})`;
                const textColor = ratio > 0.6 ? '#ffffff' : '#1f2937';
                
                return { bg: bgColor, text: textColor };
            }

            const allValues = dataToShow.flat();
            const minValue = Math.min(...allValues);
            const maxValue = Math.max(...allValues);

            let heatmapHtml = '';
            heatmapData.teams.forEach((team, idx) => {
                const weekValues = dataToShow[idx];
                const total = weekValues.reduce((a, b) => a + b, 0);
                const average = (total / weekValues.length).toFixed(1);
                const displayValue = currentHeatmapView === 'hours' ? total : average;
                
                heatmapHtml += '<tr>';
                heatmapHtml += `<td>${team}</td>`;
                
                weekValues.forEach(value => {
                    const color = getHeatColor(value, minValue, maxValue);
                    heatmapHtml += `
                        <td class="heatmap-cell" style="background: ${color.bg}; color: ${color.text};">
                            <span class="heatmap-value">${value}${suffix}</span>
                        </td>
                    `;
                });
                
                heatmapHtml += `<td class="heatmap-cell heatmap-total">${displayValue}${suffix}</td>`;
                heatmapHtml += '</tr>';
            });

            document.getElementById('heatmapBody').innerHTML = heatmapHtml;

            // Update last column header
            const lastColumnHeader = document.getElementById('heatmapLastColumn');
            if (lastColumnHeader) {
                lastColumnHeader.textContent = currentHeatmapView === 'hours' ? 'T·ªïng' : 'TB';
            }

            // Update legend
            const legendContainer = document.querySelector('.heatmap-legend');
            if (legendContainer) {
                legendContainer.remove();
            }
            
            const legendHtml = `
                <div class="heatmap-legend">
                    <span style="font-weight: 600; color: var(--text-primary);">C∆∞·ªùng ƒë·ªô ${currentHeatmapView === 'hours' ? 'gi·ªù l√†m' : 'c√¥ng su·∫•t'}:</span>
                    <div style="flex: 1;">
                        <div class="legend-gradient">
                            <div style="background: #dbeafe;"></div>
                            <div style="background: #bfdbfe;"></div>
                            <div style="background: #93c5fd;"></div>
                            <div style="background: #60a5fa;"></div>
                            <div style="background: #3b82f6;"></div>
                            <div style="background: #2563eb;"></div>
                            <div style="background: #1e40af;"></div>
                            <div style="background: #1e3a8a;"></div>
                        </div>
                        <div class="legend-labels">
                            <span>Th·∫•p (${minValue}${suffix})</span>
                            <span>Cao (${maxValue}${suffix})</span>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('heatmapContainer').insertAdjacentHTML('afterend', legendHtml);
        }

        // Initial render
        renderHeatmap();

        // PAGE 2 - TEAM DETAILS
        let currentTeam = 0;
        
        const teamDetailData = {
            employees: [
                { name: 'Nguy·ªÖn VƒÉn A', role: 'Senior Dev', projects: 3, hours: 176, capacity: 95, h1: 140, h2: 28, h3: 8 },
                { name: 'Tr·∫ßn Th·ªã B', role: 'Mid Dev', projects: 2, hours: 168, capacity: 88, h1: 140, h2: 20, h3: 8 },
                { name: 'L√™ Ho√†ng C', role: 'Junior Dev', projects: 2, hours: 152, capacity: 80, h1: 140, h2: 12, h3: 0 },
                { name: 'Ph·∫°m Minh D', role: 'Tech Lead', projects: 4, hours: 184, capacity: 98, h1: 140, h2: 36, h3: 8 },
                { name: 'ƒê·∫∑ng Qu·ªëc E', role: 'Mid Dev', projects: 2, hours: 160, capacity: 85, h1: 140, h2: 16, h3: 4 }
            ],
            projects: [
                { name: 'D·ª± √Ån A', hours: 420, tasks: [
                    { name: 'Frontend Development', date: '2026-01-03', employee: 'Nguy·ªÖn VƒÉn A', hours: 8, type: 'H1', status: 'Ho√†n th√†nh' },
                    { name: 'Backend API', date: '2026-01-04', employee: 'Tr·∫ßn Th·ªã B', hours: 10, type: 'H2', status: 'ƒêang l√†m' },
                    { name: 'Testing', date: '2026-01-05', employee: 'L√™ Ho√†ng C', hours: 6, type: 'H1', status: 'Ho√†n th√†nh' }
                ]},
                { name: 'D·ª± √Ån B', hours: 360, tasks: [
                    { name: 'Database Design', date: '2026-01-02', employee: 'Ph·∫°m Minh D', hours: 12, type: 'H2', status: 'Ho√†n th√†nh' },
                    { name: 'Code Review', date: '2026-01-06', employee: 'ƒê·∫∑ng Qu·ªëc E', hours: 4, type: 'H1', status: 'ƒêang l√†m' }
                ]},
                { name: 'D·ª± √Ån C', hours: 280, tasks: [] },
                { name: 'D·ª± √Ån D', hours: 240, tasks: [] }
            ]
        };
        
        function selectTeam(btn, index) {
            currentTeam = index;
            document.querySelectorAll('#page2 .button-group .btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            initPage2();
        }

        function initPage2() {
            const teamNames = ['BRV1', 'BRV2', 'BRV3', 'BRV4', 'BRV5', 'BRV6', 'BRV7', 'BRV8'];
            const team = teamData.labels[currentTeam];
            const totalHours = teamData.totalHours[currentTeam];
            const employees = teamData.employees[currentTeam];
            const projects = teamData.projects[currentTeam];
            
            // Update KPIs
            document.getElementById('teamTotalHours').textContent = totalHours.toLocaleString();
            document.getElementById('teamEmployees').textContent = employees;
            document.getElementById('teamCapacity').textContent = Math.round(72 + currentTeam * 3) + '%';
            document.getElementById('teamProjects').textContent = projects;

            // Chart 1: Team Hours (Column with standard line)
            if (charts.chartTeamHours) charts.chartTeamHours.destroy();
            charts.chartTeamHours = new Chart(document.getElementById('chartTeamHours'), {
                type: 'bar',
                data: {
                    labels: ['Tu·∫ßn 1', 'Tu·∫ßn 2', 'Tu·∫ßn 3', 'Tu·∫ßn 4'],
                    datasets: [
                        {
                            label: 'Gi·ªù L√†m',
                            data: [520, 560, 540, 580],
                            backgroundColor: '#3b82f6',
                            borderRadius: 6,
                            type: 'bar'
                        },
                        {
                            label: 'Gi·ªù Chu·∫©n',
                            data: [500, 500, 500, 500],
                            borderColor: '#f59e0b',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            type: 'line',
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { position: 'top' } },
                    scales: { 
                        y: { beginAtZero: true, grid: { color: '#e5e7eb' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // Chart 2: Capacity Over Time (Line with thresholds)
            if (charts.chartTeamCapacity) charts.chartTeamCapacity.destroy();
            charts.chartTeamCapacity = new Chart(document.getElementById('chartTeamCapacity'), {
                type: 'line',
                data: {
                    labels: ['Tu·∫ßn 1', 'Tu·∫ßn 2', 'Tu·∫ßn 3', 'Tu·∫ßn 4'],
                    datasets: [
                        { 
                            label: 'T·ªëi Thi·ªÉu', 
                            data: [60, 60, 60, 60], 
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderDash: [5, 5],
                            borderWidth: 1.5,
                            pointRadius: 0
                        },
                        { 
                            label: 'TB C√¥ng Ty', 
                            data: [75, 75, 75, 75], 
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderDash: [3, 3],
                            borderWidth: 1.5,
                            pointRadius: 0
                        },
                        { 
                            label: 'C√¥ng Su·∫•t Team', 
                            data: [72, 78, 82, 85], 
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: '#10b981',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { 
                        legend: { position: 'top' }
                    },
                    scales: { 
                        y: { beginAtZero: true, max: 100, grid: { color: '#e5e7eb' } }
                    }
                }
            });

            // Chart 3: Project Hours (Horizontal Bar)
            if (charts.chartTeamProjects) charts.chartTeamProjects.destroy();
            charts.chartTeamProjects = new Chart(document.getElementById('chartTeamProjects'), {
                type: 'bar',
                data: {
                    labels: teamDetailData.projects.map(p => p.name),
                    datasets: [{
                        label: 'Gi·ªù L√†m',
                        data: teamDetailData.projects.map(p => p.hours),
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'],
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: { 
                        x: { beginAtZero: true, grid: { color: '#e5e7eb' } },
                        y: { grid: { display: false } }
                    }
                }
            });

            // Work Structure Matrix
            renderWorkStructureMatrix();
            
            // Employee Table
            renderTeamEmployeeTable();
            
            // Employee Heatmap
            renderEmployeeHeatmap();
            
            // Project Work Table
            renderProjectWorkTable();
        }
        
        function renderWorkStructureMatrix() {
            const matrixData = [
                { level: 'H1', label: 'H√†nh Ch√≠nh', regular: 1120, ot: 0, expanded: false, children: [
                    { label: 'Coding', regular: 560, ot: 0 },
                    { label: 'Meeting', regular: 280, ot: 0 },
                    { label: 'Review', regular: 280, ot: 0 }
                ]},
                { level: 'H2', label: 'OT Th∆∞·ªùng', regular: 0, ot: 560, expanded: false, children: [
                    { label: 'Hotfix', regular: 0, ot: 280 },
                    { label: 'Development', regular: 0, ot: 280 }
                ]},
                { level: 'H3', label: 'OT Cu·ªëi Tu·∫ßn', regular: 0, ot: 120, expanded: false, children: [
                    { label: 'Emergency', regular: 0, ot: 80 },
                    { label: 'Deployment', regular: 0, ot: 40 }
                ]}
            ];
            
            let html = '<table style="width: 100%; border-collapse: collapse;">';
            html += '<thead><tr style="background: #f8fafc;"><th style="padding: 10px; text-align: left;">Lo·∫°i Gi·ªù</th><th style="padding: 10px; text-align: right;">H√†nh Ch√≠nh (h)</th><th style="padding: 10px; text-align: right;">OT (h)</th></tr></thead>';
            html += '<tbody>';
            
            matrixData.forEach((row, idx) => {
                const total = row.regular + row.ot;
                html += `
                    <tr style="background: ${idx % 2 === 0 ? '#fff' : '#f9fafb'}; border-bottom: 1px solid #e5e7eb; cursor: pointer;" onclick="toggleWorkStructure(${idx})">
                        <td style="padding: 8px; font-weight: 600;">
                            <span id="expand-icon-${idx}" style="display: inline-block; width: 20px; font-weight: bold;">${row.children ? '+' : ''}</span>
                            ${row.level} - ${row.label}
                        </td>
                        <td style="padding: 8px; text-align: right;">${row.regular}h</td>
                        <td style="padding: 8px; text-align: right;">${row.ot}h</td>
                    </tr>
                `;
                
                if (row.children) {
                    row.children.forEach(child => {
                        html += `
                            <tr id="work-child-${idx}" style="display: none; background: #fafbfc; border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 6px 6px 6px 40px; font-size: 0.9rem; color: #6b7280;">‚Ü≥ ${child.label}</td>
                                <td style="padding: 6px; text-align: right; font-size: 0.9rem; color: #6b7280;">${child.regular}h</td>
                                <td style="padding: 6px; text-align: right; font-size: 0.9rem; color: #6b7280;">${child.ot}h</td>
                            </tr>
                        `;
                    });
                }
            });
            
            html += '</tbody></table>';
            document.getElementById('teamWorkStructure').innerHTML = html;
        }
        
        function toggleWorkStructure(index) {
            const icon = document.getElementById(`expand-icon-${index}`);
            const children = document.querySelectorAll(`#work-child-${index}`);
            const isExpanded = icon.textContent === '-';
            
            icon.textContent = isExpanded ? '+' : '-';
            children.forEach(child => {
                child.style.display = isExpanded ? 'none' : 'table-row';
            });
        }
        
        function renderTeamEmployeeTable() {
            let html = '';
            teamDetailData.employees.forEach(emp => {
                html += `
                    <tr>
                        <td><strong>${emp.name}</strong></td>
                        <td>${emp.role}</td>
                        <td><span class="highlight-number highlight-info">${emp.projects}</span></td>
                        <td><span class="highlight-number highlight-primary">${emp.hours}h</span></td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${emp.capacity}%"></div>
                            </div>
                            ${emp.capacity}%
                        </td>
                        <td><span class="highlight-number highlight-success">${emp.h1}h</span></td>
                        <td><span class="highlight-number highlight-warning">${emp.h2}h</span></td>
                        <td><span class="highlight-number highlight-orange">${emp.h3}h</span></td>
                    </tr>
                `;
            });
            document.getElementById('teamEmployeeTableBody').innerHTML = html;
        }
        
        function renderEmployeeHeatmap() {
            function getHeatColor(value, min, max) {
                const ratio = (value - min) / (max - min);
                const r = Math.round(220 - (ratio * 120));
                const g = Math.round(240 - (ratio * 80));
                const b = Math.round(220 - (ratio * 120));
                const bgColor = `rgb(${r}, ${g}, ${b})`;
                const textColor = ratio > 0.6 ? '#ffffff' : '#1f2937';
                return { bg: bgColor, text: textColor };
            }
            
            const weekData = [
                [42, 44, 40, 45],
                [40, 42, 41, 43],
                [38, 36, 40, 38],
                [46, 44, 48, 46],
                [40, 38, 42, 40]
            ];
            
            const allValues = weekData.flat();
            const minValue = Math.min(...allValues);
            const maxValue = Math.max(...allValues);
            
            let html = '';
            teamDetailData.employees.forEach((emp, idx) => {
                const weeks = weekData[idx];
                const total = weeks.reduce((a, b) => a + b, 0);
                html += '<tr>';
                html += `<td><strong>${emp.name}</strong></td>`;
                weeks.forEach(val => {
                    const color = getHeatColor(val, minValue, maxValue);
                    html += `<td class="heatmap-cell" style="background: ${color.bg}; color: ${color.text};"><span class="heatmap-value">${val}h</span></td>`;
                });
                html += `<td class="heatmap-cell heatmap-total">${total}h</td>`;
                html += '</tr>';
            });
            
            document.getElementById('employeeHeatmapBody').innerHTML = html;
        }
        
        function renderProjectWorkTable() {
            let html = '';
            teamDetailData.projects.forEach((project, pIdx) => {
                const hasChildren = project.tasks && project.tasks.length > 0;
                html += `
                    <tr style="background: #f8fafc; font-weight: 600; cursor: pointer;" onclick="toggleProjectTasks(${pIdx})">
                        <td style="text-align: center;">
                            <span id="project-icon-${pIdx}">${hasChildren ? '+' : ''}</span>
                        </td>
                        <td><strong>üìÅ ${project.name}</strong></td>
                        <td>-</td>
                        <td>-</td>
                        <td><strong>${project.hours}h</strong></td>
                        <td>-</td>
                        <td><span class="badge badge-info">D·ª± √°n</span></td>
                    </tr>
                `;
                
                if (hasChildren) {
                    project.tasks.forEach(task => {
                        const statusClass = task.status === 'Ho√†n th√†nh' ? 'badge-success' : 'badge-warning';
                        html += `
                            <tr id="project-task-${pIdx}" style="display: none; background: #fff;">
                                <td></td>
                                <td style="padding-left: 30px;">‚Ü≥ ${task.name}</td>
                                <td>${task.date}</td>
                                <td>${task.employee}</td>
                                <td>${task.hours}h</td>
                                <td><span class="badge badge-info">${task.type}</span></td>
                                <td><span class="badge ${statusClass}">${task.status}</span></td>
                            </tr>
                        `;
                    });
                }
            });
            document.getElementById('projectWorkTableBody').innerHTML = html;
        }
        
        function toggleProjectTasks(index) {
            const icon = document.getElementById(`project-icon-${index}`);
            const tasks = document.querySelectorAll(`#project-task-${index}`);
            const isExpanded = icon.textContent === '-';
            
            icon.textContent = isExpanded ? '+' : '-';
            tasks.forEach(task => {
                task.style.display = isExpanded ? 'none' : 'table-row';
            });
        }
        
        function applyTeamFilters() {
            const timeFilter = document.getElementById('filterTimeTeam').value;
            const workTypeFilter = document.getElementById('filterWorkTypeTeam').value;
            const groupsFilter = document.getElementById('filterGroupsTeam').value;
            const employeeFilter = document.getElementById('filterEmployee').value;
            
            console.log('Team Filters Applied:', {
                time: timeFilter,
                workType: workTypeFilter,
                groups: groupsFilter,
                employee: employeeFilter
            });
            
            // Update team display based on filters
            if (groupsFilter !== 'all') {
                const teamIndex = ['brv1', 'brv2', 'brv3', 'brv4', 'brv5', 'brv6', 'brv7', 'brv8'].indexOf(groupsFilter);
                if (teamIndex !== -1) {
                    currentTeam = teamIndex;
                }
            }
            
            initPage2();
        }
        
        function resetTeamFilters() {
            document.getElementById('filterTimeTeam').value = 'month';
            document.getElementById('filterWorkTypeTeam').value = 'all';
            document.getElementById('filterGroupsTeam').value = 'all';
            document.getElementById('filterEmployee').value = 'all';
            currentTeam = 0;
            initPage2();
        }

        // Old Page 2 code - removed duplicate functions
        
        // PAGE 3 - EMPLOYEE DETAILS
        let currentEmployee = 0;
        
        const employeeDetailData = {
            profiles: [
                { name: 'Nguy·ªÖn VƒÉn A', initials: 'NA', role: 'Senior Dev', team: 'BRV1', email: 'nguyen.a@company.com', phone: '0912-345-678', joinDate: '15/03/2020', experience: '5 nƒÉm 10 th√°ng', projects: 3, utilization: 95, weekHours: 43, monthHours: 176 },
                { name: 'Tr·∫ßn Th·ªã B', initials: 'TB', role: 'Lead Dev', team: 'BRV2', email: 'tran.b@company.com', phone: '0912-456-789', joinDate: '20/05/2019', experience: '6 nƒÉm 8 th√°ng', projects: 4, utilization: 92, weekHours: 42, monthHours: 168 },
                { name: 'Ph·∫°m Minh C', initials: 'PC', role: 'Mid Dev', team: 'BRV1', email: 'pham.c@company.com', phone: '0912-567-890', joinDate: '10/08/2021', experience: '4 nƒÉm 5 th√°ng', projects: 2, utilization: 80, weekHours: 38, monthHours: 152 },
                { name: 'L√™ Ho√†ng D', initials: 'LD', role: 'Junior Dev', team: 'BRV3', email: 'le.d@company.com', phone: '0912-678-901', joinDate: '01/11/2022', experience: '3 nƒÉm 2 th√°ng', projects: 1, utilization: 65, weekHours: 32, monthHours: 128 },
                { name: 'ƒê·∫∑ng Qu·ªëc E', initials: 'DE', role: 'Senior Dev', team: 'BRV4', email: 'dang.e@company.com', phone: '0912-789-012', joinDate: '12/02/2020', experience: '5 nƒÉm 11 th√°ng', projects: 3, utilization: 88, weekHours: 40, monthHours: 160 },
                { name: 'V≈© Thanh F', initials: 'VF', role: 'Engineer', team: 'BRV5', email: 'vu.f@company.com', phone: '0912-890-123', joinDate: '25/07/2021', experience: '4 nƒÉm 6 th√°ng', projects: 2, utilization: 85, weekHours: 39, monthHours: 156 },
                { name: 'B√πi H∆∞∆°ng G', initials: 'BG', role: 'Lead', team: 'BRV6', email: 'bui.g@company.com', phone: '0912-901-234', joinDate: '18/09/2019', experience: '6 nƒÉm 4 th√°ng', projects: 2, utilization: 78, weekHours: 36, monthHours: 144 },
                { name: 'Cao Xu√¢n H', initials: 'CH', role: 'Mid Dev', team: 'BRV7', email: 'cao.h@company.com', phone: '0912-012-345', joinDate: '05/01/2021', experience: '5 nƒÉm', projects: 2, utilization: 90, weekHours: 41, monthHours: 164 },
                { name: 'D∆∞∆°ng Th·∫ø I', initials: 'DI', role: 'Mid Dev', team: 'CAD1', email: 'duong.i@company.com', phone: '0912-123-456', joinDate: '14/04/2021', experience: '4 nƒÉm 9 th√°ng', projects: 2, utilization: 82, weekHours: 37, monthHours: 148 },
                { name: 'Ho√†ng Minh K', initials: 'HK', role: 'Junior Dev', team: 'SPORT', email: 'hoang.k@company.com', phone: '0912-234-567', joinDate: '22/12/2022', experience: '3 nƒÉm 1 th√°ng', projects: 1, utilization: 70, weekHours: 30, monthHours: 120 }
            ],
            workByDay: [
                { task: 'Frontend Development - D·ª± √°n A', mon: 8, tue: 7, wed: 8, thu: 0, fri: 6, sat: 0, sun: 0 },
                { task: 'Backend API - D·ª± √°n A', mon: 0, tue: 0, wed: 0, thu: 8, fri: 2, sat: 4, sun: 0 },
                { task: 'Code Review - D·ª± √°n B', mon: 0, tue: 1, wed: 0, thu: 0, fri: 0, sat: 0, sun: 0 },
                { task: 'Meeting & Planning', mon: 2, tue: 2, wed: 2, thu: 2, fri: 2, sat: 0, sun: 0 },
                { task: 'Testing - D·ª± √°n C', mon: 0, tue: 0, wed: 0, thu: 0, fri: 4, sat: 2, sun: 0 }
            ]
        };
        
        function loadEmployeeDetail() {
            const empIndex = parseInt(document.getElementById('empSelector').value);
            currentEmployee = empIndex;
            const emp = employeeDetailData.profiles[empIndex];
            
            // Update profile
            document.getElementById('empInitials').textContent = emp.initials;
            document.getElementById('empName').textContent = emp.name;
            document.getElementById('empRole').textContent = emp.role;
            document.getElementById('empTeam').textContent = emp.team;
            document.getElementById('empEmail').textContent = emp.email;
            document.getElementById('empPhone').textContent = emp.phone;
            document.getElementById('empJoinDate').textContent = emp.joinDate;
            document.getElementById('empExperience').textContent = emp.experience;
            
            // Update KPIs
            document.getElementById('empProjects').textContent = emp.projects;
            document.getElementById('empUtilization').textContent = emp.utilization + '%';
            document.getElementById('empWeekHours').textContent = emp.weekHours;
            document.getElementById('empMonthHours').textContent = emp.monthHours;
            
            // Render charts
            renderEmpCharts();
            
            // Render work by day
            renderWorkByDay();
        }
        
        function renderEmpCharts() {
            // Chart 1: Hours over time
            if (charts.chartEmpHours) charts.chartEmpHours.destroy();
            charts.chartEmpHours = new Chart(document.getElementById('chartEmpHours'), {
                type: 'line',
                data: {
                    labels: ['Tu·∫ßn 1', 'Tu·∫ßn 2', 'Tu·∫ßn 3', 'Tu·∫ßn 4'],
                    datasets: [
                        {
                            label: 'Gi·ªù L√†m',
                            data: [42, 45, 40, 43],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 4,
                            pointBackgroundColor: '#3b82f6',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Gi·ªù Chu·∫©n',
                            data: [40, 40, 40, 40],
                            borderColor: '#ef4444',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            fill: false,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { 
                        legend: { 
                            display: true,
                            position: 'top',
                            labels: { font: { size: 11 }, padding: 10 }
                        },
                        datalabels: {
                            display: (context) => context.datasetIndex === 0,
                            color: '#3b82f6',
                            font: { weight: 'bold', size: 11 },
                            formatter: (value) => value + 'h'
                        }
                    },
                    scales: { 
                        y: { 
                            beginAtZero: true, 
                            grid: { color: '#e5e7eb' },
                            title: { display: true, text: 'Gi·ªù', font: { size: 11 } }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
            
            // Chart 2: Hours per project
            if (charts.chartEmpProjects) charts.chartEmpProjects.destroy();
            charts.chartEmpProjects = new Chart(document.getElementById('chartEmpProjects'), {
                type: 'doughnut',
                data: {
                    labels: ['D·ª± √Ån A', 'D·ª± √Ån B', 'D·ª± √Ån C'],
                    datasets: [{
                        data: [72, 56, 48],
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        datalabels: {
                            color: '#fff',
                            font: { weight: 'bold', size: 12 },
                            formatter: (value, context) => {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(0);
                                return value + 'h\\n' + percentage + '%';
                            }
                        }
                    }
                }
            });
            
            // Work structure matrix
            const matrixHtml = `
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="background: #f8fafc;">
                            <th style="padding: 6px; text-align: left; border: 1px solid #e5e7eb;">Lo·∫°i</th>
                            <th style="padding: 6px; text-align: right; border: 1px solid #e5e7eb;">Gi·ªù</th>
                            <th style="padding: 6px; text-align: right; border: 1px solid #e5e7eb;">%</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr onclick="toggleWorkStructureRow('h1')" style="cursor: pointer;">
                            <td style="padding: 6px; border: 1px solid #e5e7eb; font-weight: 600;">
                                <span id="toggle-h1" style="display: inline-block; width: 16px; color: #3b82f6; font-weight: bold;">‚àí</span> H1 - H√†nh Ch√≠nh
                            </td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-primary">140h</span></td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-success">79.5%</span></td>
                        </tr>
                        <tr class="work-detail-h1" style="background: #f9fafb;">
                            <td style="padding: 6px; border: 1px solid #e5e7eb; padding-left: 30px;">Coding</td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-info">70h</span></td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;">39.8%</td>
                        </tr>
                        <tr class="work-detail-h1" style="background: #f9fafb;">
                            <td style="padding: 6px; border: 1px solid #e5e7eb; padding-left: 30px;">Meeting</td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-info">42h</span></td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;">23.9%</td>
                        </tr>
                        <tr class="work-detail-h1" style="background: #f9fafb;">
                            <td style="padding: 6px; border: 1px solid #e5e7eb; padding-left: 30px;">Review</td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-info">28h</span></td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;">15.9%</td>
                        </tr>
                        <tr onclick="toggleWorkStructureRow('h2')" style="cursor: pointer;">
                            <td style="padding: 6px; border: 1px solid #e5e7eb; font-weight: 600;">
                                <span id="toggle-h2" style="display: inline-block; width: 16px; color: #3b82f6; font-weight: bold;">+</span> H2 - OT Th∆∞·ªùng
                            </td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-warning">28h</span></td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-warning">15.9%</span></td>
                        </tr>
                        <tr class="work-detail-h2" style="background: #fef9f5; display: none;">
                            <td style="padding: 6px; border: 1px solid #e5e7eb; padding-left: 30px;">Overtime Weekday</td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-warning">28h</span></td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;">15.9%</td>
                        </tr>
                        <tr onclick="toggleWorkStructureRow('h3')" style="cursor: pointer;">
                            <td style="padding: 6px; border: 1px solid #e5e7eb; font-weight: 600;">
                                <span id="toggle-h3" style="display: inline-block; width: 16px; color: #3b82f6; font-weight: bold;">+</span> H3 - OT Cu·ªëi Tu·∫ßn
                            </td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-orange">8h</span></td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-orange">4.5%</span></td>
                        </tr>
                        <tr class="work-detail-h3" style="background: #fef9f5; display: none;">
                            <td style="padding: 6px; border: 1px solid #e5e7eb; padding-left: 30px;">Weekend Overtime</td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;"><span class="highlight-number highlight-orange">8h</span></td>
                            <td style="padding: 6px; border: 1px solid #e5e7eb; text-align: right;">4.5%</td>
                        </tr>
                        <tr style="background: #e0f2fe; font-weight: 700;">
                            <td style="padding: 8px; border: 1px solid #3b82f6;">T·ªîNG C·ªòNG</td>
                            <td style="padding: 8px; border: 1px solid #3b82f6; text-align: right;"><span class="highlight-number highlight-primary">176h</span></td>
                            <td style="padding: 8px; border: 1px solid #3b82f6; text-align: right;">100%</td>
                        </tr>
                    </tbody>
                </table>
            `;
            document.getElementById('empWorkStructure').innerHTML = matrixHtml;
        }
        
        function toggleWorkStructureRow(category) {
            const rows = document.querySelectorAll('.work-detail-' + category);
            const toggle = document.getElementById('toggle-' + category);
            const isHidden = rows[0].style.display === 'none';
            
            rows.forEach(row => {
                row.style.display = isHidden ? 'table-row' : 'none';
            });
            
            toggle.textContent = isHidden ? '‚àí' : '+';
        }
        
        function renderWorkByDay() {
            let html = '';
            
            // Find max hours for heatmap scaling
            let maxHours = 0;
            employeeDetailData.workByDay.forEach(work => {
                const hours = [work.mon, work.tue, work.wed, work.thu, work.fri, work.sat, work.sun];
                maxHours = Math.max(maxHours, ...hours);
            });
            
            employeeDetailData.workByDay.forEach(work => {
                const total = work.mon + work.tue + work.wed + work.thu + work.fri + work.sat + work.sun;
                const getHeatmapColor = (hours, isWeekend = false) => {
                    if (hours === 0) return 'padding: 10px; border: 1px solid #e5e7eb; text-align: center; color: #d1d5db; background: #fafafa;';
                    const intensity = hours / maxHours;
                    const baseColor = isWeekend ? '245, 158, 11' : '34, 197, 94'; // orange for weekend, green for weekday
                    const bgColor = `rgba(${baseColor}, ${0.15 + intensity * 0.7})`;
                    return `padding: 10px; border: 1px solid #e5e7eb; text-align: center; background: ${bgColor}; font-weight: 600; color: ${intensity > 0.6 ? '#fff' : '#1f2937'};`;
                };
                
                html += `
                    <tr>
                        <td style="padding: 10px; border: 1px solid #e5e7eb; font-weight: 500; background: #f0f9ff;">${work.task}</td>
                        <td style="${getHeatmapColor(work.mon)}">${work.mon || '-'}</td>
                        <td style="${getHeatmapColor(work.tue)}">${work.tue || '-'}</td>
                        <td style="${getHeatmapColor(work.wed)}">${work.wed || '-'}</td>
                        <td style="${getHeatmapColor(work.thu)}">${work.thu || '-'}</td>
                        <td style="${getHeatmapColor(work.fri)}">${work.fri || '-'}</td>
                        <td style="${getHeatmapColor(work.sat, true)}">${work.sat || '-'}</td>
                        <td style="${getHeatmapColor(work.sun, true)}">${work.sun || '-'}</td>
                        <td style="padding: 10px; border: 1px solid #3b82f6; text-align: center; background: #e0f2fe; font-weight: 700;"><span class="highlight-number highlight-primary">${total}h</span></td>
                    </tr>
                `;
            });
            
            // Add total row
            const totals = {
                mon: employeeDetailData.workByDay.reduce((s, w) => s + w.mon, 0),
                tue: employeeDetailData.workByDay.reduce((s, w) => s + w.tue, 0),
                wed: employeeDetailData.workByDay.reduce((s, w) => s + w.wed, 0),
                thu: employeeDetailData.workByDay.reduce((s, w) => s + w.thu, 0),
                fri: employeeDetailData.workByDay.reduce((s, w) => s + w.fri, 0),
                sat: employeeDetailData.workByDay.reduce((s, w) => s + w.sat, 0),
                sun: employeeDetailData.workByDay.reduce((s, w) => s + w.sun, 0)
            };
            const grandTotal = Object.values(totals).reduce((a, b) => a + b, 0);
            
            html += `
                <tr style="background: #f8fafc; font-weight: 700; border-top: 3px solid #3b82f6;">
                    <td style="padding: 12px; background: #e0f2fe; border: none;">T·ªîNG C·ªòNG</td>
                    <td style="padding: 12px; text-align: center; border: none;"><span class="highlight-number highlight-primary">${totals.mon}h</span></td>
                    <td style="padding: 12px; text-align: center; border: none;"><span class="highlight-number highlight-primary">${totals.tue}h</span></td>
                    <td style="padding: 12px; text-align: center; border: none;"><span class="highlight-number highlight-primary">${totals.wed}h</span></td>
                    <td style="padding: 12px; text-align: center; border: none;"><span class="highlight-number highlight-primary">${totals.thu}h</span></td>
                    <td style="padding: 12px; text-align: center; border: none;"><span class="highlight-number highlight-primary">${totals.fri}h</span></td>
                    <td style="padding: 12px; text-align: center; background: #fef3c7; border: none;"><span class="highlight-number highlight-warning">${totals.sat}h</span></td>
                    <td style="padding: 12px; text-align: center; background: #fef3c7; border: none;"><span class="highlight-number highlight-warning">${totals.sun}h</span></td>
                    <td style="padding: 12px; text-align: center; background: #dbeafe; border: none;"><span class="highlight-number highlight-primary" style="font-size: 1.1rem;">${grandTotal}h</span></td>
                </tr>
            `;
            
            document.getElementById('empWorkByDayBody').innerHTML = html;
        }
        
        function showHourlyDetails() {
            alert('Ch·ª©c nƒÉng chi ti·∫øt theo gi·ªù ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn.\n\nS·∫Ω hi·ªÉn th·ªã timeline chi ti·∫øt t·ª´ng gi·ªù trong ng√†y c·ªßa nh√¢n s·ª± ƒë∆∞·ª£c ch·ªçn.');
        }
        
        function initPage3() {
            loadEmployeeDetail();
        }

        // Old Page 3 functions for reference (not used in new design)
        function filterEmployees() {
            const dept = document.getElementById('empDeptFilter').value;
            const sort = document.getElementById('empSortFilter').value;

            let filtered = dept === 'All' ? employees : employees.filter(e => e.department === dept);

            if (sort === 'name') filtered.sort((a, b) => a.name.localeCompare(b.name));
            if (sort === 'utilization') filtered.sort((a, b) => b.utilization - a.utilization);
            if (sort === 'salary') filtered.sort((a, b) => b.salary - a.salary);

            // Update KPIs
            const avgUtil = Math.round(filtered.reduce((s, e) => s + e.utilization, 0) / filtered.length);
            const avgHours = (filtered.reduce((s, e) => s + e.hours, 0) / filtered.length).toFixed(1);
            const avgSalary = Math.round(filtered.reduce((s, e) => s + e.salary, 0) / filtered.length);

            document.getElementById('empTotal').textContent = filtered.length;
            document.getElementById('empAvgUtil').textContent = avgUtil + '%';
            document.getElementById('empAvgHours').textContent = avgHours;
            document.getElementById('empAvgSalary').textContent = avgSalary + 'K';

            // Update Table
            let html = '';
            filtered.forEach(e => {
                html += `
                    <tr>
                        <td>${e.name}</td>
                        <td><span class="badge badge-success">${e.department}</span></td>
                        <td>${e.role}</td>
                        <td>${e.hours}</td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${e.utilization}%"></div>
                            </div>
                            ${e.utilization}%
                        </td>
                        <td>${e.projects}</td>
                        <td>${e.salary}</td>
                    </tr>
                `;
            });
            document.getElementById('empTableBody').innerHTML = html;

            initPage3Charts();
        }

        // Duplicate initPage3 removed - using the one defined after renderWorkByDay()

        function initPage3Charts() {
            const dept = document.getElementById('empDeptFilter').value;
            const filtered = dept === 'All' ? employees : employees.filter(e => e.department === dept);

            // Emp Utilization
            if (charts.empUtil) charts.empUtil.destroy();
            charts.empUtil = new Chart(document.getElementById('chartEmpUtilization'), {
                type: 'bar',
                data: {
                    labels: filtered.map(e => e.name.split(' ')[2] || e.name.substring(0, 3)),
                    datasets: [
                        { label: 'Utilization %', data: filtered.map(e => e.utilization), backgroundColor: '#667eea' },
                        { label: 'Hours/Week', data: filtered.map(e => e.hours), backgroundColor: '#764ba2' }
                    ]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true } }
                }
            });

            // Dept Distribution
            const deptCounts = {};
            employees.forEach(e => {
                deptCounts[e.department] = (deptCounts[e.department] || 0) + 1;
            });

            if (charts.empDept) charts.empDept.destroy();
            charts.empDept = new Chart(document.getElementById('chartEmpDept'), {
                type: 'bar',
                data: {
                    labels: Object.keys(deptCounts),
                    datasets: [{
                        label: 'Employees',
                        data: Object.values(deptCounts),
                        backgroundColor: '#f093fb'
                    }]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        // Filter functions
        let originalTeamData = null;
        let originalHeatmapData = null;
        
        function applyFilters() {
            const timeFilter = document.getElementById('filterTime').value;
            const workTypeFilter = document.getElementById('filterWorkType').value;
            const groupsFilter = document.getElementById('filterGroups').value;
            
            console.log('Filters Applied:', {
                time: timeFilter,
                workType: workTypeFilter,
                groups: groupsFilter
            });
            
            // Save original data if not saved
            if (!originalTeamData) {
                originalTeamData = JSON.parse(JSON.stringify(teamData));
                originalHeatmapData = JSON.parse(JSON.stringify(heatmapData));
            }
            
            // Reset to original
            teamData = JSON.parse(JSON.stringify(originalTeamData));
            heatmapData = JSON.parse(JSON.stringify(originalHeatmapData));
            
            // Apply filters
            applyGroupFilter(groupsFilter);
            applyWorkTypeFilter(workTypeFilter);
            applyTimeFilter(timeFilter);
            
            // Update dashboard
            updateDashboard();
        }
        
        function applyGroupFilter(filter) {
            if (filter === 'all') return;
            
            const groupIndex = ['brv1', 'brv2', 'brv3', 'brv4', 'brv5', 'brv6', 'brv7', 'brv8'].indexOf(filter);
            if (groupIndex !== -1) {
                teamData.labels = [teamData.labels[groupIndex]];
                teamData.totalHours = [teamData.totalHours[groupIndex]];
                teamData.employees = [teamData.employees[groupIndex]];
                teamData.projects = [teamData.projects[groupIndex]];
                
                heatmapData.teams = [heatmapData.teams[groupIndex]];
                heatmapData.weeks = [heatmapData.weeks[groupIndex]];
                heatmapData.capacity = [heatmapData.capacity[groupIndex]];
            }
        }
        
        function applyWorkTypeFilter(filter) {
            if (filter === 'all') return;
            
            const multipliers = {
                'h1': 0.65,      // 65% gi·ªù h√†nh ch√≠nh
                'h2': 0.25,      // 25% OT th∆∞·ªùng
                'h3': 0.10,      // 10% OT cu·ªëi tu·∫ßn
                'regular': 0.65, // Ch·ªâ h√†nh ch√≠nh
                'overtime': 0.35 // Ch·ªâ OT
            };
            
            const mult = multipliers[filter] || 1;
            teamData.totalHours = teamData.totalHours.map(h => Math.round(h * mult));
            heatmapData.weeks = heatmapData.weeks.map(weekArray => 
                weekArray.map(h => Math.round(h * mult))
            );
        }
        
        function applyTimeFilter(filter) {
            if (filter === 'month') return;
            
            const adjustments = {
                'last-month': 0.92,
                'last-quarter': 0.88,
                'quarter': 1.05,
                'year': 1.08,
                'custom': 1.0
            };
            
            const adj = adjustments[filter] || 1;
            teamData.totalHours = teamData.totalHours.map(h => Math.round(h * adj));
            heatmapData.weeks = heatmapData.weeks.map(weekArray => 
                weekArray.map(h => Math.round(h * adj))
            );
        }
        
        function resetFilters() {
            document.getElementById('filterTime').value = 'month';
            document.getElementById('filterWorkType').value = 'all';
            document.getElementById('filterGroups').value = 'all';
            
            if (originalTeamData) {
                teamData = JSON.parse(JSON.stringify(originalTeamData));
                heatmapData = JSON.parse(JSON.stringify(originalHeatmapData));
            }
            
            updateDashboard();
        }
        
        function updateDashboard() {
            // Update team comparison table
            let tableHtml = '';
            teamData.labels.forEach((label, index) => {
                const totalHours = teamData.totalHours[index];
                const employees = teamData.employees[index];
                const projects = teamData.projects[index];
                const avgPerEmployee = (totalHours / employees).toFixed(1);
                const avgPerProject = (totalHours / projects).toFixed(1);
                const efficiency = avgPerEmployee >= 100 ? 'Cao' : avgPerEmployee >= 80 ? 'Trung B√¨nh' : 'Th·∫•p';
                const efficiencyClass = avgPerEmployee >= 100 ? 'badge-success' : avgPerEmployee >= 80 ? 'badge-warning' : 'badge-danger';
                
                tableHtml += `
                    <tr>
                        <td><strong>${label}</strong></td>
                        <td><span class="highlight-number highlight-primary">${totalHours.toLocaleString()}</span></td>
                        <td><span class="highlight-number highlight-info">${employees}</span></td>
                        <td><span class="highlight-number highlight-success">${avgPerEmployee}</span></td>
                        <td><span class="highlight-number highlight-info">${projects}</span></td>
                        <td><span class="highlight-number highlight-orange">${avgPerProject}</span></td>
                        <td><span class="badge ${efficiencyClass}">${efficiency}</span></td>
                    </tr>
                `;
            });
            document.getElementById('teamHoursTableBody').innerHTML = tableHtml;
            
            // Update heatmap
            renderHeatmap();
            
            // Update work hours chart
            if (charts.chartWorkHours) {
                const total = teamData.totalHours.reduce((a, b) => a + b, 0);
                charts.chartWorkHours.data.datasets[0].data = [
                    Math.round(total * 0.82),
                    Math.round(total * 0.87),
                    Math.round(total * 0.91),
                    total,
                    Math.round(total * 1.03),
                    Math.round(total * 1.08)
                ];
                charts.chartWorkHours.update();
            }
        }

        // Filter functions merged - removed duplicate declarations
        function applyFilters() {
            const timeFilter = document.getElementById('filterTime').value;
            const workTypeFilter = document.getElementById('filterWorkType').value;
            const groupsFilter = document.getElementById('filterGroups').value;
            
            console.log('Filters Applied:', {
                time: timeFilter,
                workType: workTypeFilter,
                groups: groupsFilter
            });
            
            // Save original data if not saved
            if (!originalTeamData) {
                originalTeamData = JSON.parse(JSON.stringify(teamData));
                originalHeatmapData = JSON.parse(JSON.stringify(heatmapData));
            }
            
            // Reset to original
            teamData = JSON.parse(JSON.stringify(originalTeamData));
            heatmapData = JSON.parse(JSON.stringify(originalHeatmapData));
            
            // Apply filters
            applyGroupFilter(groupsFilter);
            applyWorkTypeFilter(workTypeFilter);
            applyTimeFilter(timeFilter);
            
            // Update dashboard
            updateDashboard();
        }
        
        function applyGroupFilter(filter) {
            if (filter === 'all') return;
            
            const groupIndex = ['brv1', 'brv2', 'brv3', 'brv4', 'brv5', 'brv6', 'brv7', 'brv8'].indexOf(filter);
            if (groupIndex !== -1) {
                teamData.labels = [teamData.labels[groupIndex]];
                teamData.totalHours = [teamData.totalHours[groupIndex]];
                teamData.employees = [teamData.employees[groupIndex]];
                teamData.projects = [teamData.projects[groupIndex]];
                
                heatmapData.teams = [heatmapData.teams[groupIndex]];
                heatmapData.weeks = [heatmapData.weeks[groupIndex]];
                heatmapData.capacity = [heatmapData.capacity[groupIndex]];
            }
        }
        
        function applyWorkTypeFilter(filter) {
            if (filter === 'all') return;
            
            const multipliers = {
                'h1': 0.65,      // 65% gi·ªù h√†nh ch√≠nh
                'h2': 0.25,      // 25% OT th∆∞·ªùng
                'h3': 0.10,      // 10% OT cu·ªëi tu·∫ßn
                'regular': 0.65, // Ch·ªâ h√†nh ch√≠nh
                'overtime': 0.35 // Ch·ªâ OT
            };
            
            const mult = multipliers[filter] || 1;
            teamData.totalHours = teamData.totalHours.map(h => Math.round(h * mult));
            heatmapData.weeks = heatmapData.weeks.map(weekArray => 
                weekArray.map(h => Math.round(h * mult))
            );
        }
        
        function applyTimeFilter(filter) {
            if (filter === 'month') return;
            
            const adjustments = {
                'last-month': 0.92,
                'last-quarter': 0.88,
                'quarter': 1.05,
                'year': 1.08,
                'custom': 1.0
            };
            
            const adj = adjustments[filter] || 1;
            teamData.totalHours = teamData.totalHours.map(h => Math.round(h * adj));
            heatmapData.weeks = heatmapData.weeks.map(weekArray => 
                weekArray.map(h => Math.round(h * adj))
            );
        }
        
        function resetFilters() {
            document.getElementById('filterTime').value = 'month';
            document.getElementById('filterWorkType').value = 'all';
            document.getElementById('filterGroups').value = 'all';
            
            if (originalTeamData) {
                teamData = JSON.parse(JSON.stringify(originalTeamData));
                heatmapData = JSON.parse(JSON.stringify(originalHeatmapData));
            }
            
            updateDashboard();
        }
        
        function updateDashboard() {
            // Update team comparison table
            let tableHtml = '';
            teamData.labels.forEach((label, index) => {
                const totalHours = teamData.totalHours[index];
                const employees = teamData.employees[index];
                const projects = teamData.projects[index];
                const avgPerEmployee = (totalHours / employees).toFixed(1);
                const avgPerProject = (totalHours / projects).toFixed(1);
                const efficiency = avgPerEmployee >= 100 ? 'Cao' : avgPerEmployee >= 80 ? 'Trung B√¨nh' : 'Th·∫•p';
                const efficiencyClass = avgPerEmployee >= 100 ? 'badge-success' : avgPerEmployee >= 80 ? 'badge-warning' : 'badge-danger';
                
                tableHtml += `
                    <tr>
                        <td><strong>${label}</strong></td>
                        <td><span class="highlight-number highlight-primary">${totalHours.toLocaleString()}</span></td>
                        <td><span class="highlight-number highlight-info">${employees}</span></td>
                        <td><span class="highlight-number highlight-success">${avgPerEmployee}</span></td>
                        <td><span class="highlight-number highlight-info">${projects}</span></td>
                        <td><span class="highlight-number highlight-orange">${avgPerProject}</span></td>
                        <td><span class="badge ${efficiencyClass}">${efficiency}</span></td>
                    </tr>
                `;
            });
            document.getElementById('teamHoursTableBody').innerHTML = tableHtml;
            
            // Update heatmap
            renderHeatmap();
            
            // Update work hours chart
            if (charts.chartWorkHours) {
                const total = teamData.totalHours.reduce((a, b) => a + b, 0);
                charts.chartWorkHours.data.datasets[0].data = [
                    Math.round(total * 0.82),
                    Math.round(total * 0.87),
                    Math.round(total * 0.91),
                    total,
                    Math.round(total * 1.03),
                    Math.round(total * 1.08)
                ];
                charts.chartWorkHours.update();
            }
        }

        // Init Page 1 on Load
        initPage1();
    </script>
</body>
</html>
